# iOS-specific GraphQL Types

# iOS detailed product types
enum ProductTypeIOS {
  Consumable
  NonConsumable
  AutoRenewableSubscription
  NonRenewingSubscription
}

# iOS subscription period units
enum SubscriptionPeriodIOS {
  Day
  Week
  Month
  Year
  # Represents an unspecified/empty period
  Empty
}

# Payment modes (EMPTY represents an unspecified/empty value)
enum PaymentModeIOS {
  Empty
  FreeTrial
  PayAsYouGo
  PayUpFront
}

# iOS subscription offer details
enum SubscriptionOfferTypeIOS {
  Introductory
  Promotional
  """
  Win-back offer type (iOS 18+)
  Used to re-engage churned subscribers with a discount or free trial.
  """
  WinBack
}

# iOS subscription period (unit + value)
type SubscriptionPeriodValueIOS {
  unit: SubscriptionPeriodIOS!
  value: Int!
}

"""
iOS subscription offer details.
@deprecated Use the standardized SubscriptionOffer type instead for cross-platform compatibility.
@see https://openiap.dev/docs/types#subscription-offer
"""
type SubscriptionOfferIOS
  @deprecated(reason: "Use SubscriptionOffer type instead") {
  displayPrice: String!
  id: ID!
  paymentMode: PaymentModeIOS!
  period: SubscriptionPeriodValueIOS!
  periodCount: Int!
  price: Float!
  type: SubscriptionOfferTypeIOS!
}

type SubscriptionInfoIOS {
  introductoryOffer: SubscriptionOfferIOS
  promotionalOffers: [SubscriptionOfferIOS!]
  subscriptionGroupId: String!
  subscriptionPeriod: SubscriptionPeriodValueIOS!
}

# iOS product
type ProductIOS implements ProductCommon {
  # Common fields
  id: ID!
  title: String!
  description: String!
  type: ProductType!
  displayName: String
  displayPrice: String!
  currency: String!
  price: Float
  debugDescription: String
  platform: IapPlatform!

  # iOS-specific
  displayNameIOS: String!
  isFamilyShareableIOS: Boolean!
  jsonRepresentationIOS: String!
  typeIOS: ProductTypeIOS!

  # Standardized cross-platform fields
  """
  Standardized subscription offers.
  Cross-platform type with iOS-specific fields using suffix.
  Note: iOS does not support one-time product discounts.
  @see https://openiap.dev/docs/types#subscription-offer
  """
  subscriptionOffers: [SubscriptionOffer!]

  # Deprecated platform-specific field
  """
  @deprecated Use subscriptionOffers instead for cross-platform compatibility.
  """
  subscriptionInfoIOS: SubscriptionInfoIOS
    @deprecated(reason: "Use subscriptionOffers instead")
}

# iOS subscription product
type ProductSubscriptionIOS implements ProductCommon {
  # Common fields
  id: ID!
  title: String!
  description: String!
  type: ProductType!
  displayName: String
  displayPrice: String!
  currency: String!
  price: Float
  debugDescription: String
  platform: IapPlatform!

  # iOS-specific
  displayNameIOS: String!
  isFamilyShareableIOS: Boolean!
  jsonRepresentationIOS: String!
  typeIOS: ProductTypeIOS!

  # Standardized cross-platform fields
  """
  Standardized subscription offers.
  Cross-platform type with iOS-specific fields using suffix.
  @see https://openiap.dev/docs/types#subscription-offer
  """
  subscriptionOffers: [SubscriptionOffer!]

  # Deprecated platform-specific fields
  """
  @deprecated Use subscriptionOffers instead for cross-platform compatibility.
  """
  subscriptionInfoIOS: SubscriptionInfoIOS
    @deprecated(reason: "Use subscriptionOffers instead")

  """
  @deprecated Use subscriptionOffers instead for cross-platform compatibility.
  """
  discountsIOS: [DiscountIOS!] @deprecated(reason: "Use subscriptionOffers instead")

  introductoryPriceIOS: String
  introductoryPriceAsAmountIOS: String
  introductoryPricePaymentModeIOS: PaymentModeIOS!
  introductoryPriceNumberOfPeriodsIOS: String
  introductoryPriceSubscriptionPeriodIOS: SubscriptionPeriodIOS
  subscriptionPeriodNumberIOS: String
  subscriptionPeriodUnitIOS: SubscriptionPeriodIOS
}

"""
Discount information returned from the store.
@deprecated Use the standardized SubscriptionOffer type instead for cross-platform compatibility.
@see https://openiap.dev/docs/types#subscription-offer
"""
type DiscountIOS @deprecated(reason: "Use SubscriptionOffer type instead") {
  identifier: String!
  type: String!
  numberOfPeriods: Int!
  price: String!
  priceAmount: Float!
  paymentMode: PaymentModeIOS!
  subscriptionPeriod: String!
  localizedPrice: String
}

# iOS purchase details
type PurchaseIOS implements PurchaseCommon {
  # Common fields
  id: ID!
  productId: String!
  ids: [String!]
  transactionDate: Float!
  purchaseToken: String
  """
  Store where purchase was made
  """
  store: IapStore!
  platform: IapPlatform! @deprecated(reason: "Use store instead")
  quantity: Int!
  purchaseState: PurchaseState!
  isAutoRenewing: Boolean!
  currentPlanId: String

  # iOS-specific fields
  transactionId: String!
  quantityIOS: Int
  originalTransactionDateIOS: Float
  originalTransactionIdentifierIOS: String
  appAccountToken: String
  expirationDateIOS: Float
  webOrderLineItemIdIOS: String
  environmentIOS: String
  storefrontCountryCodeIOS: String
  appBundleIdIOS: String
  subscriptionGroupIdIOS: String
  isUpgradedIOS: Boolean
  ownershipTypeIOS: String
  reasonIOS: String
  reasonStringRepresentationIOS: String
  transactionReasonIOS: String
  revocationDateIOS: Float
  revocationReasonIOS: String
  offerIOS: PurchaseOfferIOS
  currencyCodeIOS: String
  currencySymbolIOS: String
  countryCodeIOS: String
  renewalInfoIOS: RenewalInfoIOS
}

type PurchaseOfferIOS {
  id: String!
  type: String!
  paymentMode: String!
}

# iOS purchase inputs (for in-app products: consumables and non-consumables)
input RequestPurchaseIosProps {
  """
  Product SKU
  """
  sku: String!
  """
  Auto-finish transaction (dangerous)
  """
  andDangerouslyFinishTransactionAutomatically: Boolean
  """
  App account token for user tracking
  """
  appAccountToken: String
  """
  Purchase quantity
  """
  quantity: Int
  """
  Promotional offer to apply (subscriptions only, ignored for one-time purchases).
  iOS only supports promotional offers for auto-renewable subscriptions.
  """
  withOffer: DiscountOfferInputIOS
  """
  Advanced commerce data token (iOS 15+).
  Used with StoreKit 2's Product.PurchaseOption.custom API for passing
  campaign tokens, affiliate IDs, or other attribution data.
  The data is formatted as JSON: {"signatureInfo": {"token": "<value>"}}
  """
  advancedCommerceData: String
}

# iOS uses the same props for subscriptions
input RequestSubscriptionIosProps {
  sku: String!
  andDangerouslyFinishTransactionAutomatically: Boolean
  appAccountToken: String
  quantity: Int
  """
  Promotional offer to apply for subscription purchases.
  Requires server-signed offer with nonce, timestamp, keyId, and signature.
  """
  withOffer: DiscountOfferInputIOS
  """
  Win-back offer to apply (iOS 18+)
  Used to re-engage churned subscribers with a discount or free trial.
  The offer is available when the customer is eligible and can be discovered
  via StoreKit Message (automatic) or subscription offer APIs.
  """
  winBackOffer: WinBackOfferInputIOS
  """
  JWS promotional offer (iOS 15+, WWDC 2025).
  New signature format using compact JWS string for promotional offers.
  Back-deployed to iOS 15.
  """
  promotionalOfferJWS: PromotionalOfferJWSInputIOS
  """
  Override introductory offer eligibility (iOS 15+, WWDC 2025).
  Set to true to indicate the user is eligible for introductory offer,
  or false to indicate they are not. When nil, the system determines eligibility.
  Back-deployed to iOS 15.
  """
  introductoryOfferEligibility: Boolean
  """
  Advanced commerce data token (iOS 15+).
  Used with StoreKit 2's Product.PurchaseOption.custom API for passing
  campaign tokens, affiliate IDs, or other attribution data.
  The data is formatted as JSON: {"signatureInfo": {"token": "<value>"}}
  """
  advancedCommerceData: String
}

# iOS Discount Offer (input)
input DiscountOfferInputIOS {
  """
  Discount identifier
  """
  identifier: String!
  """
  Key identifier for validation
  """
  keyIdentifier: String!
  """
  Cryptographic nonce
  """
  nonce: String!
  """
  Signature for validation
  """
  signature: String!
  """
  Timestamp of discount offer
  """
  timestamp: Float!
}

"""
Win-back offer input for iOS 18+ (StoreKit 2)
Win-back offers are used to re-engage churned subscribers.
The offer is automatically presented via StoreKit Message when eligible,
or can be applied programmatically during purchase.
"""
input WinBackOfferInputIOS {
  """
  The win-back offer ID from App Store Connect
  """
  offerId: String!
}

"""
JWS promotional offer input for iOS 15+ (StoreKit 2, WWDC 2025).
New signature format using compact JWS string for promotional offers.
This provides a simpler alternative to the legacy signature-based promotional offers.
Back-deployed to iOS 15.
"""
input PromotionalOfferJWSInputIOS {
  """
  The promotional offer identifier from App Store Connect
  """
  offerId: String!
  """
  Compact JWS string signed by your server.
  The JWS should contain the promotional offer signature data.
  Format: header.payload.signature (base64url encoded)
  """
  jws: String!
}

"""
Apple App Store verification parameters.
Used for server-side receipt validation via App Store Server API.
"""
input VerifyPurchaseAppleOptions {
  """
  Product SKU to validate
  """
  sku: String!
}

type VerifyPurchaseResultIOS {
  """
  Whether the receipt is valid
  """
  isValid: Boolean!
  """
  Receipt data string
  """
  receiptData: String!
  """
  JWS representation
  """
  jwsRepresentation: String!
  """
  Latest transaction if available
  """
  latestTransaction: Purchase
}

# StoreKit Subscription Status (iOS)
"""
Subscription renewal information from Product.SubscriptionInfo.RenewalInfo
https://developer.apple.com/documentation/storekit/product/subscriptioninfo/renewalinfo
"""
type RenewalInfoIOS {
  jsonRepresentation: String
  willAutoRenew: Boolean!
  autoRenewPreference: String

  """
  When subscription expires due to cancellation/billing issue
  Possible values: "VOLUNTARY", "BILLING_ERROR", "DID_NOT_AGREE_TO_PRICE_INCREASE", "PRODUCT_NOT_AVAILABLE", "UNKNOWN"
  """
  expirationReason: String

  """
  Grace period expiration date (milliseconds since epoch)
  When set, subscription is in grace period (billing issue but still has access)
  """
  gracePeriodExpirationDate: Float

  """
  True if subscription failed to renew due to billing issue and is retrying
  Note: Not directly available in RenewalInfo, available in Status
  """
  isInBillingRetry: Boolean

  """
  Product ID that will be used on next renewal (when user upgrades/downgrades)
  If set and different from current productId, subscription will change on expiration
  """
  pendingUpgradeProductId: String

  """
  User's response to subscription price increase
  Possible values: "AGREED", "PENDING", null (no price increase)
  """
  priceIncreaseStatus: String

  """
  Expected renewal date (milliseconds since epoch)
  For active subscriptions, when the next renewal/charge will occur
  """
  renewalDate: Float

  """
  Offer ID applied to next renewal (promotional offer, subscription offer code, etc.)
  """
  renewalOfferId: String

  """
  Type of offer applied to next renewal
  Possible values: "PROMOTIONAL", "SUBSCRIPTION_OFFER_CODE", "WIN_BACK", etc.
  """
  renewalOfferType: String
}

type SubscriptionStatusIOS {
  state: String!
  renewalInfo: RenewalInfoIOS
}

"""
iOS DiscountOffer (output type).
@deprecated Use the standardized SubscriptionOffer type instead for cross-platform compatibility.
@see https://openiap.dev/docs/types#subscription-offer
"""
type DiscountOfferIOS
  @deprecated(reason: "Use SubscriptionOffer type instead") {
  """
  Discount identifier
  """
  identifier: String!
  """
  Key identifier for validation
  """
  keyIdentifier: String!
  """
  Cryptographic nonce
  """
  nonce: String!
  """
  Signature for validation
  """
  signature: String!
  """
  Timestamp of discount offer
  """
  timestamp: Float!
}

# StoreKit entitlement (iOS 15+)
type EntitlementIOS {
  sku: String!
  transactionId: String!
  jsonRepresentation: String!
}

type RefundResultIOS {
  status: String!
  message: String
}

type AppTransaction {
  bundleId: String!
  appVersion: String!
  originalAppVersion: String!
  originalPurchaseDate: Float!
  deviceVerification: String!
  deviceVerificationNonce: String!
  environment: String!
  signedDate: Float!
  appId: Float!
  appVersionId: Float!
  preorderDate: Float
  appTransactionId: String
  originalPlatform: String
}

"""
Result of presenting external purchase notice sheet (iOS 18.2+)
"""
type ExternalPurchaseNoticeResultIOS {
  """
  Notice result indicating user action
  """
  result: ExternalPurchaseNoticeAction!
  """
  Optional error message if the presentation failed
  """
  error: String
}

"""
User actions on external purchase notice sheet (iOS 18.2+)
"""
enum ExternalPurchaseNoticeAction {
  """
  User chose to continue to external purchase
  """
  Continue
  """
  User dismissed the notice sheet
  """
  Dismissed
}

"""
Result of presenting an external purchase link (iOS 18.2+)
"""
type ExternalPurchaseLinkResultIOS {
  """
  Whether the user completed the external purchase flow
  """
  success: Boolean!
  """
  Optional error message if the presentation failed
  """
  error: String
}
